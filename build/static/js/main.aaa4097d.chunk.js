(this["webpackJsonpgoit-react-hw-08-phonebook"]=this["webpackJsonpgoit-react-hw-08-phonebook"]||[]).push([[0],{11:function(t,n,e){"use strict";e.d(n,"f",(function(){return d})),e.d(n,"g",(function(){return f})),e.d(n,"b",(function(){return O})),e.d(n,"e",(function(){return h})),e.d(n,"c",(function(){return g})),e.d(n,"i",(function(){return p})),e.d(n,"h",(function(){return E})),e.d(n,"d",(function(){return x})),e.d(n,"a",(function(){return m}));var c=e(24),r=e.n(c),o=e(30),a=e(5),u=e(12),i=e.n(u),s=e(14),b=e.n(s);i.a.defaults.baseURL="".concat("https://connections-api.herokuapp.com");var l=function(t){i.a.defaults.headers.common.Authorization="".concat(t)},j=function(){i.a.defaults.headers.common.Authorization=""},d=Object(a.b)("auth/FETCH_START"),f=Object(a.b)("auth/FETCH_SUCCESS"),O=Object(a.b)("auth/FETCH_FAILURE"),h=function(t){return function(n){n(d()),i.a.post("/users/signup",t).then((function(t){return t.data})).then((function(t){n(f(t)),l(t.token),b()("Congratulations!","You have created an account!","success")})).catch((function(t){n(O()),b()("Oops!","Error ".concat(t.response.status," occured."),"error")}))}},g=function(t){return function(n){n(d()),i.a.post("/users/login",t).then((function(t){return t.data})).then((function(t){n(f(t)),l(t.token),b()("Hello, ".concat(t.user.name),"You have logged into your account!","success")})).catch((function(t){n(O()),b()("Oops! Wrong mail or password.","Error ".concat(t.response.status," occured."),"error")}))}},p=Object(a.b)("logout/FETCH_SUCCESS"),E=Object(a.b)("logout/FETCH_FAILURE"),x=function(t){return function(t){t(d()),i.a.post("/users/logout",null).then((function(t){return t})).then((function(n){t(p()),b()("Bye!","You have logged out of your account!","success"),j()})).catch((function(n){t(E()),console.log(n),b()("Oops! Something went wrong","Error ".concat(n.response.status," occured."),"error")}))}},m=Object(a.c)("auth/REFRESH",function(){var t=Object(o.a)(r.a.mark((function t(n,e){var c,o,a,u;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=e.getState(),""!==(o=c.userReducer.token)){t.next=5;break}return console.log("no token = no fetch"),t.abrupt("return",e.isRejectedWithValue());case 5:return l(o),t.prev=6,t.next=9,i.a.get("/users/current");case 9:return a=t.sent,u=a.data,t.abrupt("return",u);case 14:t.prev=14,t.t0=t.catch(6),console.log(t.t0);case 17:case"end":return t.stop()}}),t,null,[[6,14]])})));return function(n,e){return t.apply(this,arguments)}}())},110:function(t,n,e){"use strict";e.r(n);var c,r,o=e(0),a=e(22),u=e.n(a),i=(e(52),e(53),e(54),e(19)),s=e(1),b=e(29),l=e.n(b),j=e(44),d=e(6),f=e(28),O=e(3),h=e(5),g=e(15),p=e(11),E=Object(h.e)({name:"register",initialState:{user:{name:"",email:""},token:"",isLoggedIn:!1,loading:!1,isFetchingCurrentUser:!1},extraReducers:(c={},Object(d.a)(c,p.f,(function(t,n){return Object(O.a)(Object(O.a)({},t),{},{loading:!0})})),Object(d.a)(c,p.g,(function(t,n){return Object(O.a)(Object(O.a)({},t),{},{loading:!1,isLoggedIn:!0,token:n.payload.token,user:{name:n.payload.user.name,email:n.payload.user.email}})})),Object(d.a)(c,p.b,(function(t,n){return Object(O.a)(Object(O.a)({},t),{},{loading:!1})})),Object(d.a)(c,p.i,(function(t,n){return Object(O.a)(Object(O.a)({},t),{},{user:{name:"",email:""},token:"",isLoggedIn:!1,loading:!1})})),Object(d.a)(c,p.h,(function(t,n){return Object(O.a)(Object(O.a)({},t),{},{loading:!1})})),Object(d.a)(c,p.a.pending,(function(t,n){t.isFetchingCurrentUser=!0})),Object(d.a)(c,p.a.fulfilled,(function(t,n){t.user=n.payload,t.isLoggedIn=!0,t.isFetchingCurrentUser=!1})),Object(d.a)(c,p.a.rejected,(function(t,n){t.isFetchingCurrentUser=!1})),c)}),x=E.reducer,m=(E.actions.setUser,e(27)),C=e(45),v=e.n(C),y=Object(h.d)({contacts:[],filter:"",loading:!1},(r={},Object(d.a)(r,g.h,(function(t,n){return Object(O.a)(Object(O.a)({},t),{},{filter:n.payload.target.value})})),Object(d.a)(r,g.f,(function(t,n){return Object(O.a)(Object(O.a)({},t),{},{loading:!0})})),Object(d.a)(r,g.g,(function(t,n){return Object(O.a)(Object(O.a)({},t),{},{loading:!1,contacts:[].concat(Object(f.a)(t.contacts),Object(f.a)(n.payload))})})),Object(d.a)(r,g.d,(function(t,n){return Object(O.a)(Object(O.a)({},t),{},{loading:!1})})),Object(d.a)(r,g.c,(function(t,n){var e=t.contacts.filter((function(t){return t.id!=n.payload}));return Object(O.a)(Object(O.a)({},t),{},{loading:!1,contacts:e})})),Object(d.a)(r,p.i,(function(t,n){return Object(O.a)(Object(O.a)({},t),{},{contacts:[]})})),r)),k={key:"auth",storage:v.a,whitelist:["token"]},F=Object(h.a)({reducer:{contacts:y,userReducer:Object(m.a)(k,x)},devTools:!1}),S=Object(m.b)(F),R=F,T=e(13),U=e(47),H=e.n(U),L=e(2);function w(t){var n=t.children,e=Object(T.d)((function(t){return t.userReducer.isLoggedIn}));return console.log(e),e||H.a.fire("You are not logged in yet","Please login or create an accound before accessing your contacts","question"),e?n:Object(L.jsx)(s.a,{to:"/register"})}function I(t){var n=t.children,e=t.restricted,c=void 0!==e&&e;return Object(T.d)((function(t){return t.userReducer.isLoggedIn}))&&c?Object(L.jsx)(s.a,{to:"/"}):n}var _=Object(o.lazy)((function(){return e.e(4).then(e.bind(null,119))})),z=Object(o.lazy)((function(){return e.e(5).then(e.bind(null,115))})),A=Object(o.lazy)((function(){return e.e(8).then(e.bind(null,120))})),Y=Object(o.lazy)((function(){return e.e(7).then(e.bind(null,118))})),B=Object(o.lazy)((function(){return e.e(6).then(e.bind(null,116))})),J=Object(o.lazy)((function(){return e.e(3).then(e.bind(null,117))}));var W=function(){var t=Object(T.c)(),n=Object(T.d)((function(t){return t.userReducer.isFetchingCurrentUser}));return Object(o.useEffect)((function(){t(Object(p.a)())}),[t]),!n&&Object(L.jsx)(j.a,{loading:null,persistor:S,children:Object(L.jsx)(o.Suspense,{fallback:Object(L.jsx)(l.a,{className:"fallback-loader"}),children:Object(L.jsxs)(i.a,{children:[Object(L.jsx)(_,{}),Object(L.jsxs)(s.d,{children:[Object(L.jsx)(s.b,{path:"/",element:Object(L.jsx)(A,{})}),Object(L.jsx)(s.b,{path:"/register",element:Object(L.jsx)(I,{restricted:!0,children:Object(L.jsx)(B,{})})}),Object(L.jsx)(s.b,{path:"/login",element:Object(L.jsx)(I,{restricted:!0,children:Object(L.jsx)(J,{})})}),Object(L.jsx)(s.b,{path:"/contacts",element:Object(L.jsx)(w,{children:Object(L.jsx)(Y,{})})}),Object(L.jsx)(s.b,{path:"*",element:Object(L.jsx)(z,{})})]})]})})})};u.a.render(Object(L.jsx)(T.a,{store:R,children:Object(L.jsx)(W,{})}),document.getElementById("root"))},15:function(t,n,e){"use strict";e.d(n,"h",(function(){return a})),e.d(n,"f",(function(){return u})),e.d(n,"g",(function(){return i})),e.d(n,"d",(function(){return s})),e.d(n,"c",(function(){return b})),e.d(n,"e",(function(){return l})),e.d(n,"a",(function(){return j})),e.d(n,"b",(function(){return d}));var c=e(5),r=e(12),o=e.n(r),a=Object(c.b)("filter/changeFilter"),u=Object(c.b)("contacts/FETCH_START"),i=Object(c.b)("contacts/FETCH_SUCCESS"),s=Object(c.b)("contacts/FETCH_FAILURE"),b=Object(c.b)("contacts/FETCH_DELETE_SUCCESS"),l=function(t){return function(t){t(u()),o.a.get("/contacts").then((function(t){return t.data})).then((function(n){console.log(n),t(i(n))})).catch((function(n){console.log("Error fetching contacts:",n),t(s(n))}))}},j=function(t){return function(n){n(u()),o.a.post("/contacts",t).then((function(t){return t.data})).then((function(t){console.log(t),n(i([t]))})).catch((function(t){console.log("Error posting contact:",t),n(s(t))}))}},d=function(t){return function(n){var e=t.target.id;o.a.delete("/contacts/".concat(e)).then(n(u())).then((function(t){return t.data})).then((function(t){return n(b(e))})).catch((function(t){console.log("Error deleting contact:",t),n(s(t))}))}}},52:function(t,n,e){},53:function(t,n,e){}},[[110,1,2]]]);
//# sourceMappingURL=main.aaa4097d.chunk.js.map